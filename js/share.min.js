var winWidth = $(".wrap").width();
var artWidth = $(".artWrap").width();
var ua = navigator.userAgent.toLowerCase();

//滚动加载
var listpageYm = 1;
var loadflag = true;
var islistpage = false;
var lc = window.location.href;
var turl = ""
if(lc.indexOf("index") >-1 || lc.indexOf("hot") >-1 || lc.indexOf("recommend") >-1){
    islistpage = true;
}

//文章页
String.prototype.replaceAll = function(s1,s2) {
    return this.replace(new RegExp(s1,"gm"),s2);
}
function getRandomNum(Min, Max) {
    var Range = Max - Min;
    var Rand = Math.random();
    return (Min + Math.round(Rand * Range));
}
var share_imgUrl = $("#img").attr("src");
var share_desc = '橘子娱乐 | 这一年感动过我们的明星爱情';
var share_title = "这一年感动过我们的明星爱情 | 橘子娱乐™";

var getArtId =$(".artWrap").attr("id");

function animateFun(target, gtime) {
    return function() {
        $(target).show().animate({
                left: '-=' + ($(target).width() + artWidth + 100) + 'px'
            },
            gtime, animateFun).queue(function(next) {
                $(target).css("left", (artWidth + 20) + "px");
                next();
            });
    }
}

var _winScrollTop = 0;

window.onload = function(){
    lazyImgFun();
}

/*页尾下载*/
//判断有无安装app
function getUrlParam(name){
    var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
    var r = window.location.search.substr(1).match(reg);
    if (r!=null) return unescape(r[2]); return null;
}
if(getUrlParam("isappinstalled") == 1){
    $(".shareDownbtn").addClass('installed');
}
function tryOpenApps() {
    if(ua.indexOf("iphone") > -1 || ua.indexOf("android") > -1 ){
        window.location.href ="juzi://article?id="+parseInt($('.artWrap').attr('id'));
    }else{
        window.location.href = "http://www.happyjuzi.com/";
    }
}
function downloadApp(){
    if (ua.indexOf("iphone") > -1) {
        $(".shareDownbtn").attr("href", "https://itunes.apple.com/us/app/ju-zi-yu-le/id931179407?ls=1&mt=8");
    }else if(ua.indexOf("android") > -1){
        $(".shareDownbtn").attr("href", "http://files01.happyjuzi.com/juzi/apk/v1.0/juzi-juzi-release.apk");
    }
}
$(".shareDownbtn").click(function() {
    var dl2 = 'func?mod=dl&uid=';
    statPoint(getUrlString('fromuid'),'','2.3','','','','','','',dl2);
    if (ua.indexOf("micromessenger") > -1) {
        window.location.href = "http://a.app.qq.com/o/simple.jsp?pkgname=com.happyjuzi.apps.juzi";
    }else{
        if($(this).attr('class').indexOf("installed")> 0 || $(this).hasClass('installed')){
            tryOpenApps();
        }else{
            downloadApp();
        }
    }
})

var app_data_url = encodeURIComponent(lc);
var shareDatelink = "http://a.happyjuzi.com/weixin.php?url="+app_data_url;
document.write("<script type=\"text/javascript\" src=\""+shareDatelink+"\">"+"</scr"+"ipt>");

$(function() {
    wx.config({
        debug: false,
        appId: 'wxd92ccb751aa7075b',
        timestamp: timestampData,
        nonceStr: nonceStrData,
        signature: signatureData,
        jsApiList: ['checkJsApi',
            'onMenuShareTimeline',
            'onMenuShareAppMessage',
            'onMenuShareQQ',
            'onMenuShareWeibo']
    });

    wx.ready(function(){
        wx.onMenuShareTimeline({
            title: share_title,
            desc: share_title,
            link: lc,
            imgUrl: share_imgUrl
        });
        //分享给微信好友
        wx.onMenuShareAppMessage({
            title: share_title,
            desc: share_desc,
            link: lc,
            imgUrl: share_imgUrl
        });
        //分享给QQ
        wx.onMenuShareQQ({
            title: share_title,
            desc: share_desc,
            link: lc,
            imgUrl: share_imgUrl
        });
        //分享给QQ微博
        wx.onMenuShareWeibo({
            title: share_title,
            desc: share_desc,
            link: lc,
            imgUrl: share_imgUrl
        });
    })
})
//百度统计
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://": " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fb09e89e10e3dea6858cd0fa2bc457859' type='text/javascript'%3E%3C/script%3E"));
